<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Ytify Auth</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>

  <!-- Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">

  <style>
    body {
      font-family: 'Poppins', sans-serif;
      background: linear-gradient(135deg, #1f2937, #111827);
      display: flex; justify-content: center; align-items: center;
      height: 100vh; margin: 0; color: #fff;
    }
    .container {
      background: #1e1e2e; padding: 25px; border-radius: 15px;
      width: 320px; box-shadow: 0 0 20px rgba(0,0,0,0.5); text-align: center;
    }
    h2 { margin-bottom: 20px; font-weight: 600; }
    input {
      width: 100%; padding: 10px; margin: 8px 0; border-radius: 8px;
      border: none; outline: none; background: #2d2d3a; color: #fff;
    }
    button {
      width: 100%; padding: 10px; margin-top: 12px; border-radius: 8px;
      border: none; background: #3b82f6; color: white; font-weight: 600;
      cursor: pointer; transition: 0.3s;
    }
    button:hover { background: #2563eb; }
    .link { margin-top: 15px; font-size: 14px; }
    .link span { color: #3b82f6; cursor: pointer; }
    .hidden { display: none; }
    small { display:block; margin-top:10px; color:#9ca3af; font-size:12px; }
  </style>
</head>
<body>

  <div class="container">
    <!-- 🔹 Login -->
    <div id="loginPage">
      <h2>Login</h2>
      <input id="loginEmail" type="email" placeholder="Email">
      <input id="loginPass" type="password" placeholder="Password">
      <button onclick="login()">Login</button>
      <div class="link"><span onclick="showForgot()">Forgot Password?</span></div>
      <div class="link">Not have any account? <span onclick="showRegister()">Create New Account</span></div>
    </div>

    <!-- 🔹 Register -->
    <div id="registerPage" class="hidden">
      <h2>Register</h2>
      <input id="regEmail" type="email" placeholder="Email">
      <input id="regPass" type="password" placeholder="Password">
      <input id="regConfirm" type="password" placeholder="Confirm Password">
      <button onclick="register()">Register</button>
      <div class="link">Already have account? <span onclick="showLogin()">Login</span></div>
    </div>

    <!-- 🔹 Forgot -->
    <div id="forgotPage" class="hidden">
      <h2>Reset Password</h2>
      <input id="forgotEmail" type="email" placeholder="Enter your Email">
      <button onclick="resetPassword()">Send Reset Link</button>
      <small>👉 Agar email inbox me na mile to spam/junk folder check karein.</small>
      <div class="link"><span onclick="showLogin()">Back to Login</span></div>
    </div>
  </div>

  <script>
    // 🔹 Firebase Config
    const firebaseConfig = {
      apiKey: "AIzaSyDmuE4wLWv1ZGfuAUmiRBH1Pz21M3Xs4kc",
      authDomain: "ytify-8982c.firebaseapp.com",
      databaseURL: "https://ytify-8982c-default-rtdb.firebaseio.com",
      projectId: "ytify-8982c",
      storageBucket: "ytify-8982c.appspot.com",
      messagingSenderId: "1072469051926",
      appId: "1:1072469051926:web:45d164d9e150bdf0d1c337",
      measurementId: "G-VFFG8ER5Q2"
    };
    firebase.initializeApp(firebaseConfig);

    // 🔹 Login
    function login() {
      let email = document.getElementById("loginEmail").value;
      let pass = document.getElementById("loginPass").value;
      firebase.auth().signInWithEmailAndPassword(email, pass)
        .then((user) => {
          if (user.user.emailVerified) {
            window.AppInventor.setWebViewString("LOGIN_SUCCESS|" + user.email + "|" + user.uid + "|" + user.accessToken);
          } else {
            alert("⚠️ Please verify your email before login.");
            firebase.auth().signOut();
          }
        })
        .catch((err) => alert(err.message));
    }

    // 🔹 Register (with email verification)
    function register() {
      let email = document.getElementById("regEmail").value;
      let pass = document.getElementById("regPass").value;
      let confirm = document.getElementById("regConfirm").value;

      if (pass !== confirm) {
        alert("Passwords do not match!");
        return;
      }

      firebase.auth().createUserWithEmailAndPassword(email, pass)
        .then((user) => {
          user.user.sendEmailVerification()
            .then(() => {
              alert("✅ Registered! Verification email sent. Check Inbox/Spam.");
              showLogin();
            });
        })
        .catch((err) => alert(err.message));
    }

    // 🔹 Forgot Password
    function resetPassword() {
      let email = document.getElementById("forgotEmail").value;
      if (!email) return alert("Enter your email first!");
      firebase.auth().sendPasswordResetEmail(email)
        .then(() => alert("🔑 Reset link sent to " + email + ". (Check Spam/Junk too)"))
        .catch((err) => alert(err.message));
    }

    // 🔹 UI Controls
    function showLogin() {
      document.getElementById("loginPage").classList.remove("hidden");
      document.getElementById("registerPage").classList.add("hidden");
      document.getElementById("forgotPage").classList.add("hidden");
    }
    function showRegister() {
      document.getElementById("loginPage").classList.add("hidden");
      document.getElementById("registerPage").classList.remove("hidden");
      document.getElementById("forgotPage").classList.add("hidden");
    }
    function showForgot() {
      document.getElementById("loginPage").classList.add("hidden");
      document.getElementById("registerPage").classList.add("hidden");
      document.getElementById("forgotPage").classList.remove("hidden");
    } 
    firebase.auth().onAuthStateChanged((user) => {
  if (user) {
    user.getIdToken().then((token) => {
      const data = { uid: user.uid, email: user.email, token: token };
      // MIT AppInventor bridge:
      window.AppInventor.setWebViewString(JSON.stringify(data));
    });
  }
});
  </script>
</body>
</html>
