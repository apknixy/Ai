
<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Login/Register</title>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-auth.js"></script>
  <style>
    body { font-family: Arial, sans-serif; background:#f2f2f2; text-align:center; }
    .box { background:white; padding:20px; margin:50px auto; width:300px; border-radius:10px; box-shadow:0 0 10px rgba(0,0,0,0.2); }
    input { width:90%; padding:10px; margin:8px 0; border:1px solid #ccc; border-radius:5px; }
    button { width:95%; padding:10px; background:#4CAF50; color:white; border:none; border-radius:5px; cursor:pointer; }
    button:hover { background:#45a049; }
    a { display:block; margin-top:10px; color:blue; cursor:pointer; }
    .hidden { display:none; }
  </style>
</head>
<body>

<!-- Register -->
<div id="registerBox" class="box">
  <h2>Register</h2>
  <input type="email" id="regEmail" placeholder="Email">
  <input type="password" id="regPass" placeholder="Password">
  <input type="password" id="regConfirm" placeholder="Confirm Password">
  <button onclick="register()">Next</button>
  <a onclick="showLogin()">Already have account? Login</a>
</div>

<!-- Login -->
<div id="loginBox" class="box hidden">
  <h2>Login</h2>
  <input type="email" id="loginEmail" placeholder="Email">
  <input type="password" id="loginPass" placeholder="Password">
  <button onclick="login()">Login</button>
  <a onclick="showForgot()">Forgot Password?</a>
  <a onclick="showRegister()">Not have any account? Register</a>
</div>

<!-- Forgot Password -->
<div id="forgotBox" class="box hidden">
  <h2>Forgot Password</h2>
  <input type="email" id="forgotEmail" placeholder="Enter your email">
  <button onclick="resetPass()">Reset Password</button>
  <a onclick="showLogin()">Back to Login</a>
</div>

<p id="msg"></p>

<script>
  // ✅ Firebase Config डालो
  const firebaseConfig = {
    apiKey: "YOUR-API-KEY",
    authDomain: "YOUR-PROJECT.firebaseapp.com",
    projectId: "YOUR-PROJECT",
  };
  firebase.initializeApp(firebaseConfig);
  const auth = firebase.auth();

  // Toggle views
  function showLogin(){ document.getElementById('registerBox').classList.add('hidden'); document.getElementById('loginBox').classList.remove('hidden'); document.getElementById('forgotBox').classList.add('hidden'); }
  function showRegister(){ document.getElementById('registerBox').classList.remove('hidden'); document.getElementById('loginBox').classList.add('hidden'); document.getElementById('forgotBox').classList.add('hidden'); }
  function showForgot(){ document.getElementById('registerBox').classList.add('hidden'); document.getElementById('loginBox').classList.add('hidden'); document.getElementById('forgotBox').classList.remove('hidden'); }

  function showMsg(m){ document.getElementById('msg').innerText = m; }

  // ✅ Register
  function register(){
    let email = document.getElementById('regEmail').value;
    let pass = document.getElementById('regPass').value;
    let confirm = document.getElementById('regConfirm').value;
    if(pass !== confirm){ showMsg("Passwords do not match"); return; }
    auth.createUserWithEmailAndPassword(email, pass)
      .then(user => {
        user.user.sendEmailVerification();
        showMsg("Verification link sent. Check Inbox or Spam folder.");
        showLogin();
      })
      .catch(e => showMsg("Error: " + e.message));
  }

  // ✅ Login
  function login(){
    let email = document.getElementById('loginEmail').value;
    let pass = document.getElementById('loginPass').value;
    auth.signInWithEmailAndPassword(email, pass)
      .then(user => {
        if(user.user.emailVerified){
          // AppInventor को signal भेजना
          window.AppInventor.setWebViewString("LOGIN_SUCCESS:" + user.user.uid);
        } else {
          showMsg("Please verify your email first (check spam).");
        }
      })
      .catch(e => showMsg("Error: " + e.message));
  }

  // ✅ Forgot Password
  function resetPass(){
    let email = document.getElementById('forgotEmail').value;
    auth.sendPasswordResetEmail(email)
      .then(() => showMsg("Password reset link sent. Check Inbox or Spam."))
      .catch(e => showMsg("Error: " + e.message));
  }
</script>
</body>
</html>
